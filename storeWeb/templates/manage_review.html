{% extends "admin_base.html" %}

{% block title %}Qu·∫£n l√Ω ƒë√°nh gi√°{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">üìã Qu·∫£n l√Ω ƒë√°nh gi√°</h2>

    <!-- B·∫£ng danh s√°ch ƒë√°nh gi√° -->
    <div class="table-wrap">
        <table class="table table-bordered table-striped align-middle">
            <thead class="table-dark">
                <tr>
                    <th>M√£</th>
                    <th>Ng∆∞·ªùi d√πng</th>
                    <th>S·∫£n ph·∫©m</th>
                    <th>ƒê√°nh gi√° ‚≠ê</th>
                    <th>B√¨nh lu·∫≠n</th>
                    <th>Ph·∫£n h·ªìi admin</th>
                    <th>Ng√†y t·∫°o</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody>
                {% for dg in danhgias %}
                <tr>
                    <td>{{ dg.maDanhGia }}</td>
                    <td>{{ dg.hoTen if dg.hoTen else dg.tenDangNhap }}</td>
                    <td>{{ dg.tenSanPham }}</td>
                    <td>
                        {% for i in range(1,6) %}
                            {% if i <= dg.danhGia %} ‚≠ê {% else %} ‚òÜ {% endif %}
                        {% endfor %}
                    </td>
                    <td>{{ dg.binhLuan }}</td>
                    <td>
                        {% if dg.phanHoi %}
                            <span class="text-success">{{ dg.phanHoi }}</span>
                        {% else %}
                            <span class="text-muted">Ch∆∞a ph·∫£n h·ªìi</span>
                        {% endif %}
                    </td>
                    <td>{{ dg.ngayTao }}</td>
                    <td>
                        <!-- X√≥a -->
                        <a href="/admin/danhgia/xoa/{{ dg.maDanhGia }}"
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ƒë√°nh gi√° n√†y?')">
                           <i class="bi bi-trash"></i> X√≥a
                        </a>

                        <!-- N√∫t ph·∫£n h·ªìi -->
                        <button class="btn btn-primary btn-sm"
                                data-bs-toggle="modal"
                                data-bs-target="#replyModal{{ dg.maDanhGia }}">
                            <i class="bi bi-reply"></i> Ph·∫£n h·ªìi
                        </button>

                        <!-- Modal ph·∫£n h·ªìi -->
                        <div class="modal fade" id="replyModal{{ dg.maDanhGia }}" tabindex="-1">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <form method="post" action="/admin/danhgia/phanhoi/{{ dg.maDanhGia }}">
                                <div class="modal-header">
                                  <h5 class="modal-title">Ph·∫£n h·ªìi ƒë√°nh gi√° #{{ dg.maDanhGia }}</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                  <textarea name="phanHoi" class="form-control" rows="4" required>{{ dg.phanHoi if dg.phanHoi else '' }}</textarea>
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                                  <button type="submit" class="btn btn-success">G·ª≠i ph·∫£n h·ªìi</button>
                                </div>
                              </form>
                            </div>
                          </div>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" class="text-center text-muted">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
